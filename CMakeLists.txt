project(BigAnn)

cmake_minimum_required(VERSION 3.14)

set(CMAKE_CXX_STANDARD 14)
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)
find_package(OpenMP REQUIRED)

if (OPENMP_FOUND)
    set (CMAKE_C_FLAGS "${CMAKE_C_FLAGS} ${OpenMP_C_FLAGS}")
    set (CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${OpenMP_CXX_FLAGS}")
    set (CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} ${OpenMP_EXE_LINKER_FLAGS}")
endif()

set( CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11 -march=native -pthread -fopenmp -mavx2 -mfma" )
# set( CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11 -march=native -O0 -g -pthread -fopenmp -mavx2 -mfma" )

set(IOPERF 1)
if (IOPERF)
    add_compile_options(-DIOPERF=1)
    message(STATUS "Optional Flag DIOPERF is ON: to do IO Perf")
endif(IOPERF)

include_directories(include)

add_subdirectory(src)
set(build_bigann
    build_bigann.cpp
    #src/diskann2.cpp
)

set(search_bigann
    search_bigann.cpp
    #src/diskann2.cpp
)

add_executable(build_bigann ${build_bigann})
add_executable(search_bigann ${search_bigann})

add_subdirectory(test)
add_subdirectory(scripts)
target_link_libraries(build_bigann BigAnn)
target_link_libraries(search_bigann BigAnn)


